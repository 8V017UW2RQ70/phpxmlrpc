<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>5.&nbsp;xmlrpc_server</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.67.0"><link rel="start" href="index.html" title="XML-RPC for PHP"><link rel="up" href="ch05.html" title="Chapter&nbsp;5.&nbsp;Class documentation"><link rel="prev" href="ch05s04.html" title="4.&nbsp;xmlrpcval"><link rel="next" href="ch06.html" title="Chapter&nbsp;6.&nbsp;Global variables"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.&nbsp;xmlrpc_server</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s04.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;5.&nbsp;Class documentation</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch06.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xmlrpc-server"></a>5.&nbsp;xmlrpc_server</h2></div></div></div><p>The current implementation of this class has been kept as simple as possible. The constructor for the server basically does all the work. Here's a minimal example:</p><pre class="programlisting">
  function foo ($params) {
     ...
  }

  $s=new xmlrpc_server( array("examples.myFunc" =&gt;
                                array("function" =&gt; "foo")));
          </pre><p>This performs everything you need to do with a server. The single argument is an associative array from method names to function names. The request is parsed and dispatched to the relevant function, which is responsible for returning a <code class="classname">xmlrpcresp</code> object, which gets serialized back to the caller. See server.php in this distribution for examples of how to do this.</p><p>Here is a more detailed look at what the handler function <code class="function">foo</code> may do:</p><pre class="programlisting">

  function foo ($params) {
        global $xmlrpcerruser; // import user errcode value

        // $params is an Array of xmlrpcval objects

        if ($err) {
          // this is an error condition
          return new xmlrpcresp(0, $xmlrpcerruser+1, // user error 1
           "There's a problem, Captain");
        } else {
          // this is a successful value being returned
          return new xmlrpcresp(new xmlrpcval("All's fine!", "string"));
        }
  }
                </pre><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1229"></a>5.1.&nbsp;The dispatch map</h3></div></div></div><p>The first argument to the <code class="function">xmlrpc_server</code> constructor is an array, called the <span class="emphasis"><em>dispatch map</em></span>. In this array is the information the server needs to service the XML-RPC methods you define.</p><p>The dispatch map takes the form of an associative array of associative arrays: the outer array has one entry for each method, the key being the method name. The corresponding value is another associative array, which can have the following members:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="function">function</code> - this entry is mandatory. It must be a name of a function in the global scope which services the XML-RPC method.</p></li><li><p><code class="function">signature</code> - this entry is an array containing the possible signatures (see <a href="ch05s05.html#signatures">Signatures</a>) for the method. If this entry is present then the server will check that the correct number and type of parameters have been sent for this method before dispatching it.</p></li><li><p><code class="function">docstring</code> - this entry is a string containing documentation for the method. The documentation may contain HTML markup.</p></li></ul></div><p>Look at the <code class="filename">server.php</code> example in the distribution to see what a dispatch map looks like.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="signatures"></a>5.2.&nbsp;Method signatures</h3></div></div></div><p>A signature is a description of a method's return type and its parameter types. A method may have more than one signature.</p><p>Within a server's dispatch map, each method has an array of possible signatures. Each signature is an array of types. The first entry is the return type. For instance, the method </p><pre class="programlisting">
string examples.getStateName(int)
</pre><p> has the signature </p><pre class="programlisting">
array($xmlrpcString, $xmlrpcInt)
</pre><p> and, assuming that it the only possible signature for the method, might be used like this in server creation: </p><pre class="programlisting">
$findstate_sig=array(array($xmlrpcString, $xmlrpcInt));

$findstate_doc='When passed an integer between 1 and 51 returns the
name of a US state, where the integer is the index of that state name
in an alphabetic order.';

$s=new xmlrpc_server( array( "examples.getStateName" =&gt; 
                                                array("function" =&gt; "findstate",
                                                "signature" =&gt; $findstate_sig,
                                                "docstring" =&gt; $findstate_doc)));
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1280"></a>5.3.&nbsp;Delaying the server response</h3></div></div></div><p>You may want to construct the server, but for some reason not fulfill the request immediately (security verification, for instance). If you pass the constructor a second argument of <code class="literal">0</code> this will have the desired effect. You can then use the <code class="function">service()</code> method of the server class to service the request. For example:</p><pre class="programlisting">
$s=new xmlrpc_server($myDispMap, 0);

// ... some code that does other stuff here

$s-&gt;service();
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1293"></a>5.4.&nbsp;Fault reporting</h3></div></div></div><p>Fault codes for your servers should start at the value indicated by the global <code class="literal">$xmlrpcerruser</code> + 1.</p><p>Standard errors returned by the server include:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">1</code> <span>Unknown method</span></span></dt><dd><p>Returned if the server was asked to dispatch a method it didn't know about</p></dd><dt><span class="term"><code class="literal">2</code> <span>Invalid return payload</span></span></dt><dd><p>This error is actually generated by the client, not server, code, but signifies that a server returned something it couldn't understand. A more detailed error report is sometimes added onto the end of the phrase above.</p></dd><dt><span class="term"><code class="literal">3</code> <span>Incorrect parameters</span></span></dt><dd><p>This error is generated when the server has signature(s) defined for a method, and the parameters passed by the client do not match any of signatures.</p></dd><dt><span class="term"><code class="literal">4</code> <span>Can't introspect: method unknown</span></span></dt><dd><p>This error is generated by the builtin <code class="function">system.*</code> methods when any kind of introspection is attempted on a method undefined by the server.</p></dd><dt><span class="term"><code class="literal">5</code> <span>Didn't receive 200 OK from remote server</span></span></dt><dd><p>This error is generated by the client when a remote server doesn't return HTTP/1.1 200 OK in response to a request. A more detailed error report is added onto the end of the phrase above.</p></dd><dt><span class="term"><code class="literal">6</code> <span>No data received from server</span></span></dt><dd><p>This error is generated by the client when a remote server returns HTTP/1.1 200 OK in response to a request, but no response body follows the HTTP headers.</p></dd><dt><span class="term"><code class="literal">7</code> <span>No SSL support compiled in</span></span></dt><dd><p>This error is generated by the client when trying to send a request with HTTPS and the CURL extension is not available to PHP.</p></dd><dt><span class="term"><code class="literal">8</code> <span>CURL error</span></span></dt><dd><p>This error is generated by the client when trying to send a request with HTTPS and the HTTPS communication fails.</p></dd><dt><span class="term"><code class="literal">9-14</code> <span>multicall errors</span></span></dt><dd><p>These errors are generated by the server when something fails inside a system.multicall request.</p></dd><dt><span class="term"><code class="literal">100-</code> <span>XML parse errors</span></span></dt><dd><p>Returns 100 plus the XML parser error code for the fault that occurred. The <code class="function">faultString</code> returned explains where the parse error was in the incoming XML stream.</p></dd></dl></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s04.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch05.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.&nbsp;xmlrpcval&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;6.&nbsp;Global variables</td></tr></table></div></body></html>